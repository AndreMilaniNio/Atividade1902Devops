name: Arquivo deploy básico

on:
  push:
    branches: [ "master", "development" ]
  pull_request:
    branches: [ "master", "development" ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Clona repositório para o github
      - name: Clonar repositório
        uses: actions/checkout@v4

      # Verifica se meu index.html existe
      - name: Verificar se index.html existe
        run: |
          if [ ! -f "src/index.html" ]; then
            echo "ERRO: index.html não encontrado em src/pages/"
            exit 1
          else
            echo "index.html encontrado."
          fi

      # Verifica a pasta styles existem
      - name: Verificar se pasta styles existe
        run: |
          if [ ! -d "styles" ]; then
            echo "ERRO: Pasta 'styles' não encontrada."
            exit 1
          else
            echo "Pasta 'styles' encontrada."
          fi

      # Verifica meus arquivos.css
      - name: Verificar arquivos CSS obrigatórios
        run: |
          FILES=("styles/index.css" "styles/sobre.css" "styles/contato.css" "styles/main.css")

          for file in "${FILES[@]}"; do
            if [ ! -f "$file" ]; then
              echo "ERRO: Arquivo CSS obrigatório não encontrado: $file"
              exit 1
            else
              echo "$file encontrado."
            fi
          done

      # Super-Script de organização
      - name: Organizar arquivos para deploy
        run: |
          echo "1️⃣ Limpando dist antiga..."
          rm -rf dist

          echo "2️⃣ Criando nova pasta dist..."
          mkdir dist

          echo "3️⃣ Copiando todos os arquivos HTML..."
          find . -name "*.html" -exec cp --parents {} dist/ \;

          echo "4️⃣ Copiando pasta assets..."
          cp -r assets dist/ || true

          echo "5️⃣ Listando conteúdo da dist..."
          ls -R dist

      # dá upload na dist
      - name: Upload artifact para pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

      # mensagem de validação
      - name: Projeto validado com sucesso
        run: echo "Estrutura validada! Pronto para deploy."

  # Faz o deploy
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Deploy para GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4